<html>
<head>
<title>Project Bitch</title>
<script type="text/javascript" src="http://maps.google.com/maps?file=api&amp;v=2&amp;key=ABQIAAAAvdV_C7EiC5qvYhizkNRvmxQ_pFa7EbBvItR2syiehiKCeylqUhSqRWNiI9G0u5Zlh8ZrT-4fScLzTw"></script>
<script type="text/javascript" src="jquery.min.js"></script>  
<SCRIPT type="text/javascript">

/*Global Variables:
Coords - stores coordinates, index 0 is starting point, 1 is current, 2 is ending
*/
Coords = new Array(3);
var map;
var Directions;
busStops = {};

initializeBusStopCoords();

function initializeBusStopCoords()
{
	busStops[11730] = [38.037115135347000,-78.497970253229000];
	busStops[11822] = [38.037237662529800,-78.497950136661400];
	busStops[11724] = [38.034049776528500,-78.499819636344800];
	busStops[11711] = [38.034043438644800,-78.499465584754900];
	busStops[11912] = [38.035535995120400,-78.505332916974900];
	
//	busStops[11730] = [-78.497970253229000, 38.037115135347000];
//	busStops[11822] = [-78.497950136661400, 38.037237662529800];
//	busStops[11724] = [-78.499819636344800, 38.034049776528500];
//	busStops[11711] = [-78.499465584754900, 38.034043438644800];
//	busStops[11912] = [-78.505332916974900, 38.035535995120400];
}
function GetCoords (form) {
    var Start = form.StartingAddress.value;
	var End = form.Destination.value;
	
    //Ajax request for starting point
    jQuery.ajax({
		dataType: 'jsonp',
		url: 'http://maps.google.com/maps/geo?q=' + Start + '&output=json&sensor=true&key=ABQIAAAAvdV_C7EiC5qvYhizkNRvmxQ_pFa7EbBvItR2syiehiKCeylqUhSqRWNiI9G0u5Zlh8ZrT-4fScLzTw',
		cache: false,
		success: function(data){
			if(data.Status.code==200) {
				Coords[0] = [data.Placemark[0].Point.coordinates[1],data.Placemark[0].Point.coordinates[0]];
//				alert(Coords[0][0]);
				Coords[1] = FindNearestBusStop(data.Placemark[0].Point.coordinates[0],data.Placemark[0].Point.coordinates[1]);
			}
		}
	})
	
    //Ajax request for ending point
    jQuery.ajax({
		dataType: 'jsonp',
		url: 'http://maps.google.com/maps/geo?q=' + End + '&output=json&sensor=true&key=ABQIAAAAvdV_C7EiC5qvYhizkNRvmxQ_pFa7EbBvItR2syiehiKCeylqUhSqRWNiI9G0u5Zlh8ZrT-4fScLzTw',
		cache: false,
		success: function(data){
			if(data.Status.code==200) {
				Coords[2] = [data.Placemark[0].Point.coordinates[1],data.Placemark[0].Point.coordinates[0]];
//				alert("Lat: " + data.Placemark[0].Point.coordinates[1] + " Long: " + data.Placemark[0].Point.coordinates[0]);
			}
		}
	})
}

function FindBestRoute (Longitude, Latitude) {
	var StopTypes = ["A", "B", "C", "D", "E"];
	var Distance = 1000.0;
	var WinningStopType;
	for(var x in StopTypes)
	{
		for(var StopNum in busStops) {
			if(busStops[StopNum] == StopTypes[x])
			{
				
			}
		}
	}
}

function FindNearestBusStop (longitude, latitude, StopType) {
	var Distance = 1000.0;
	var ReturnStop = 0;
	
    for(var x in busStops) {
		if(busStops[x][3] == StopType){
			var TempDistance;
			TempDistance = ((busStops[x][1] - latitude)*(busStops[x][1] - latitude)) - ((busStops[x][0] - longitude)*(busStops[x][0] - longitude));
			TempDistance = Math.sqrt(TempDistance);
			if (TempDistance < Distance) {
				Distance = TempDistance;
				ReturnStop = x;
			}
		}
	}
	return busStops[ReturnStop];
}

function ShowTheMap() {
        map = new GMap2(document.getElementById("map_canvas"));
		Directions = new GDirections(map, null);
		Directions.load("From: " + Coords[0] + " To: " + Coords[2]);
		//alert("From: " + Coords[0] + " To: " + Coords[2]);
        map.setCenter(new GLatLng(Coords[0][0], Coords[0][1]), 13);
        map.setUIToDefault();
		var Start = new GLatLng(Coords[0][0], Coords[0][1]);
		var Stop = new GLatLng(Coords[1][0], Coords[1][1]);
		var End = new GLatLng(Coords[2][0], Coords[2][1]);
        map.addOverlay(new GMarker(Start));
		map.addOverlay(new GMarker(End));
		map.addOverlay(new GMarker(Stop));
}

function PopulateInfo()
{

}
</SCRIPT>
</head>
<body>
<form name="TheForm" action="" method="GET">
Enter Your Starting Address.<br><input type=text name="StartingAddress" value=""><br>
Enter Your Destination.<br><input type=text name="Destination" value="">
<br><input type=button name="button" value="Go" onClick="GetCoords(this.form)"><br><input type=button name="button" value="Build Map" onClick="ShowTheMap()"><br><input type=button name="button" value="Go" onClick="PopulateInfo">
<div id="map_canvas" style="width: 75%; height: 500px; float: left;"></div><div id="map_canvas" style="width: 25%; height: 500px; float: right; border=1px;"></div>
</form>
</body>
</html>
